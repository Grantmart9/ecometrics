server {
    listen 443 ssl;
    server_name ollama.13-48-35-34.nip.io;

    ssl_certificate /etc/letsencrypt/live/ollama.13-48-35-34.nip.io/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/ollama.13-48-35-34.nip.io/privkey.pem;

    # Handle OPTIONS for any path
    location = / {
        if ($request_method = 'OPTIONS') {
            add_header Access-Control-Allow-Origin "*" always;
            add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
            add_header Access-Control-Allow-Headers "Content-Type" always;
            return 204;
        }
        return 400;
    }

    location /api/ {
        proxy_pass http://localhost:11434;
        proxy_http_version 1.1;
        add_header Access-Control-Allow-Origin "*" always;
        add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Content-Type" always;
    }

    location = /api/generate {
        if ($request_method = 'OPTIONS') {
            add_header Access-Control-Allow-Origin "*" always;
            add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
            add_header Access-Control-Allow-Headers "Content-Type" always;
            return 204;
        }
        if ($request_method = 'GET') {
            return 405;
        }
        proxy_pass http://localhost:11434;
    }
}
